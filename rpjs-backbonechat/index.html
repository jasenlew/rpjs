<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.6.0/underscore-min.js"></script>
	<script src="http://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.1.2/backbone-min.js"></script>

	<script>

		var appleData = [
			{
				name: "fuji",
				url: "img/fuji.jpeg"
			},
			{
				name: "gala",
				url: "img/gala.jpeg"
			}
		];

		var app;

		var router = Backbone.Router.extend({
			routes: {
				'': 'home',
				'apples/:appleName': 'loadApple'
			},

			initialize: function () {
				var apples = new Apples();
				apples.reset(appleData);
				console.log(apples);
				this.homeView = new homeView({collection: apples});
				this.appleView = new appleView({collection: apples});
			},

			home : function () {
				this.homeView.render();
			},

			loadApple: function (appleName) {
				this.appleView.render(appleName);
			}

		});

		var homeView = Backbone.View.extend({
			el: 'body',
			template: _.template('Apple data: <%= data %>'),
			render: function () {
				this.$el.html(this.template({
					data: JSON.stringify(this.collection.models)
				}));
			}
		});

		var Apples = Backbone.Collection.extend({});

		var appleView = Backbone.View.extend({
			template: _.template('<figure><img src="<%= attributes.url %>" /><figcaption><%= attributes.name %></figcaption></figure>'),

			render: function (appleName) {
				var appleModel = this.collection.where({ name: appleName })[0];
				var appleHtml = this.template(appleModel);
				$("body").html(appleHtml);
			}
		});

		$(document).ready(function () {
			app = new router;
			Backbone.history.start();
		});


	</script>

</head>
<body>
	
</body>
</html>